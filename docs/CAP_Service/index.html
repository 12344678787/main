
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://github.com/SAP-samples/cloud-cap-risk-management/CAP_Service/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.7">
    
    
      
        <title>Create a CAP-Based Service - SAP BTP Application Development</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c772ddf0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../styles/additonal.css">
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@8.4.8/dist/mermaid.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="blue">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#create-a-cap-based-service" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="SAP BTP Application Development" class="md-header__button md-logo" aria-label="SAP BTP Application Development" data-md-component="logo">
      
  <img src="../markdown/images/sap.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SAP BTP Application Development
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Create a CAP-Based Service
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/SAP-samples/cloud-cap-risk-management/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="SAP BTP Application Development" class="md-nav__button md-logo" aria-label="SAP BTP Application Development" data-md-component="logo">
      
  <img src="../markdown/images/sap.svg" alt="logo">

    </a>
    SAP BTP Application Development
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/SAP-samples/cloud-cap-risk-management/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Sources/" class="md-nav__link">
        Get Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Tutorial_Overview/" class="md-nav__link">
        Tutorial Overview
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      <label class="md-nav__link" for="__nav_5">
        Create a CAP Service and SAP Fiori UI
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Create a CAP Service and SAP Fiori UI" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Create a CAP Service and SAP Fiori UI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Create a CAP-Based Service
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Create a CAP-Based Service
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-and-initialize-the-project" class="md-nav__link">
    Create and Initialize the Project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-files-to-the-project" class="md-nav__link">
    Add Files to the Project
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../FE/" class="md-nav__link">
        Create an SAP Fiori Elements-Based Application
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../CAP_Business_Logic/" class="md-nav__link">
        Add Business Logic to Your Application
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Freestyle_UI5/" class="md-nav__link">
        Create a Freestyle UI5 Application
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Launchpage/" class="md-nav__link">
        Add More Than One Application to the Launch Page
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Roles_CAP/" class="md-nav__link">
        Implement Roles and Authorization Checks in CAP
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Deploy Your CAP Service on the SAP BTP Cloud Foundry Environment
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Deploy Your CAP Service on the SAP BTP Cloud Foundry Environment" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Deploy Your CAP Service on the SAP BTP Cloud Foundry Environment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Prepare_SAP_CP_and_CF/" class="md-nav__link">
        Prepare SAP BTP and Cloud Foundry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../HANA_Setup/" class="md-nav__link">
        Set Up the SAP HANA Cloud Service
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Prepare_XSUAA/" class="md-nav__link">
        Prepare User Authentication and Authorization (XSUAA) Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../CAP_MTA_Deployment/" class="md-nav__link">
        Deploy Your Multi-Target Application (MTA)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Launchpad_Service/" class="md-nav__link">
        Add the SAP Launchpad Service
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../SAP_CP_Role_Assignment/" class="md-nav__link">
        Assign a Role Collection to a User
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Logging/" class="md-nav__link">
        Add the Application Logging Service
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Undeploy_CF/" class="md-nav__link">
        Undeploy Your Cloud Foundry Application
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Kyma/" class="md-nav__link">
        Run a CAP Application on Kyma
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-and-initialize-the-project" class="md-nav__link">
    Create and Initialize the Project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-files-to-the-project" class="md-nav__link">
    Add Files to the Project
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/SAP-samples/cloud-cap-risk-management/edit/master/docs/CAP_Service.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="create-a-cap-based-service">Create a CAP-Based Service</h1>
<details class="info"><summary>Prerequisites</summary><ul>
<li><a href="../installation">Installation</a></li>
<li><a href="../Sources">Get Started</a></li>
</ul>
</details>
<details class="note"><summary>Additional Documentation</summary><ul>
<li><a href="https://cap.cloud.sap/docs/">Official CAP documentation</a></li>
<li><a href="https://cap.cloud.sap/docs/get-started/">CAP Getting Started</a></li>
</ul>
</details>
<p>In this section, you create a new CAP-based service, which exposes the OData V4 protocol. To do so, you use CAP's tooling <code>cds init</code> and <code>cds watch</code> in a terminal.</p>
<h2 id="create-and-initialize-the-project">Create and Initialize the Project</h2>
<ol>
<li>
<p>Open a terminal.</p>
</li>
<li>
<p>Create a directory <code>&lt;myDirectory&gt;</code> on your computer, where you want to develop the app.</p>
</li>
<li>
<p>Navigate to the previously created directory:</p>
<div class="highlight"><pre><span></span><code>cd &lt;myDirectory&gt;
</code></pre></div>
</li>
<li>
<p>Create an initial CAP project by executing the command <code>cds init</code>. It creates the project in a new folder called <code>cpapp</code>:</p>
<div class="highlight"><pre><span></span><code>cds init cpapp
</code></pre></div>
</li>
<li>
<p>Navigate to the project folder:</p>
<div class="highlight"><pre><span></span><code>cd cpapp
</code></pre></div>
</li>
<li>
<p>Open the project in VS Code:</p>
<div class="highlight"><pre><span></span><code>code .
</code></pre></div>
<p>The project looks like this in VS Code:</p>
<p><img alt="VS Code" src="../markdown/images/vscode.png" title="VS Code" /></p>
</li>
<li>
<p>In VS Code choose <strong>Terminal</strong> <strong>&rarr;</strong> <strong>New Terminal</strong> from its menu.</p>
<p>A new terminal opens in the lower right part of the VS Code screen.</p>
</li>
<li>
<p>In the VS Code terminal, run:</p>
<div class="highlight"><pre><span></span><code>npm install
</code></pre></div>
</li>
<li>
<p>In the VS Code terminal, start a CAP server:</p>
<div class="highlight"><pre><span></span><code>cds watch
</code></pre></div>
<details class="error"><summary>In case you get the error: <code>cds : File &lt;npmIstallDirectory&gt;\cds.ps1 cannot be loaded because running scripts is disabled on this system.</code> </summary><p>If you get the error <code>cds : File &lt;npmIstallDirectory&gt;\cds.ps1 cannot be loaded because running scripts is disabled on this system.</code> after you run <code>cds watch</code>, you can run the command:
<div class="highlight"><pre><span></span><code>Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope CurrentUser
</code></pre></div></p>
<p>This will change the script execution policy for your user to <code>Bypass</code> directly from the VS Code terminal. To learn more about execution policies, see <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.1">About Execution Policies</a>.</p>
</details>
<p>The CAP server serves all the CAP sources from your project. It also "watches" all the files in your projects and conveniently restarts whenever you save a file. Changes you've made will immediately be served without you having to do anything.</p>
<p>The screen now looks like this:</p>
<p><img alt="CDS Watch" src="../markdown/images/cdswatch.png" title="CDS Watch" /></p>
<p>The CAP server tells you that there’s no model yet that it can serve. You add one in the next steps.</p>
</li>
</ol>
<h2 id="add-files-to-the-project">Add Files to the Project</h2>
<ol>
<li>
<p>Open the Finder on Mac or the Explorer on Windows and navigate to the directory that you’ve created for the tutorial.</p>
<div class="admonition info">
<p class="admonition-title">This is the <code>&lt;MyTutorialDirectory&gt;</code> directory created in section <a href="../Sources">Get Started</a>. It should be a subfolder of your project's parent directory.</p>
</div>
</li>
<li>
<p>Open the folder <code>templates</code> and keep it open as you copy a number of files from there. For this part of the tutorial and others, it’s probably best if you place it next to your VS Code instance like this:</p>
<p><img alt="Windows" src="../markdown/images/codeandfinder.png" title="Windows" /></p>
<p>Alternatively, you can open it as a second folder in your VS Code project: <strong>File</strong> <strong>&rarr;</strong> <strong>Add Folder to Workspace...</strong>.</p>
</li>
<li>
<p>Copy the file <code>schema.cds</code> from <code>templates/cap/create-service/db</code> to the <code>db</code> folder of your app.</p>
<p>This is the code:</p>
<p><!-- cpes-file db/schema.cds -->
<div class="highlight"><pre><span></span><code><span class="nx">namespace</span> <span class="nx">sap</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">riskmanagement</span><span class="p">;</span>
<span class="nx">using</span> <span class="p">{</span> <span class="nx">managed</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@sap/cds/common&#39;</span><span class="p">;</span>
  <span class="nx">entity</span> <span class="nx">Risks</span> <span class="o">:</span> <span class="nx">managed</span> <span class="p">{</span>
    <span class="nx">key</span> <span class="nx">ID</span>      <span class="o">:</span> <span class="nx">UUID</span>  <span class="err">@</span><span class="p">(</span><span class="nx">Core</span><span class="p">.</span><span class="nx">Computed</span> <span class="o">:</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nx">title</span>       <span class="o">:</span> <span class="nb">String</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="nx">prio</span>        <span class="o">:</span> <span class="nb">String</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="nx">descr</span>       <span class="o">:</span> <span class="nb">String</span><span class="p">;</span>
    <span class="nx">miti</span>        <span class="o">:</span> <span class="nx">Association</span> <span class="nx">to</span> <span class="nx">Mitigations</span><span class="p">;</span>
    <span class="nx">impact</span>      <span class="o">:</span> <span class="nx">Integer</span><span class="p">;</span>
    <span class="nx">criticality</span> <span class="o">:</span> <span class="nx">Integer</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">entity</span> <span class="nx">Mitigations</span> <span class="o">:</span> <span class="nx">managed</span> <span class="p">{</span>
    <span class="nx">key</span> <span class="nx">ID</span>       <span class="o">:</span> <span class="nx">UUID</span>  <span class="err">@</span><span class="p">(</span><span class="nx">Core</span><span class="p">.</span><span class="nx">Computed</span> <span class="o">:</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nx">description</span>  <span class="o">:</span> <span class="nb">String</span><span class="p">;</span>
    <span class="nx">owner</span>        <span class="o">:</span> <span class="nb">String</span><span class="p">;</span>
    <span class="nx">timeline</span>     <span class="o">:</span> <span class="nb">String</span><span class="p">;</span>
    <span class="nx">risks</span>        <span class="o">:</span> <span class="nx">Association</span> <span class="nx">to</span> <span class="nx">many</span> <span class="nx">Risks</span> <span class="nx">on</span> <span class="nx">risks</span><span class="p">.</span><span class="nx">miti</span> <span class="o">=</span> <span class="nx">$self</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></p>
<p>It creates two entities in the namespace <code>sap.ui.riskmanagement</code>: <code>Risks</code> and <code>Mitigations</code>. Each of them has a key called <code>ID</code> and several other properties. A Risk has a mitigation and, therefore, the property <code>miti</code> has an association to exactly one Mitigation. A Mitigation in turn can be used for many Risks, so it has a "to many" association. They key is automatically filled by the CAP server, which is exposed to the user of the service with the annotation <code>@(Core.Computed : true)</code>.</p>
<p>Notice how the CAP server reacted to dropping the file. It now tells you that it has a model but there are no service definitions yet and, thus, it still can’t serve anything. Next, you add a service definition.</p>
</li>
<li>
<p>Copy the file <code>risk-service.cds</code> from <code>templates/cap/create-service/srv</code> to the <code>srv</code> folder of your app.</p>
<p>The content of the file looks like this:</p>
<p><!-- cpes-file srv/risk-service.cds -->
<div class="highlight"><pre><span></span><code><span class="nx">using</span> <span class="p">{</span> <span class="nx">sap</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">riskmanagement</span> <span class="nx">as</span> <span class="nx">my</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../db/schema&#39;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;service/risk&#39;</span>
<span class="nx">service</span> <span class="nx">RiskService</span> <span class="p">{</span>
  <span class="nx">entity</span> <span class="nx">Risks</span> <span class="nx">as</span> <span class="nx">projection</span> <span class="nx">on</span> <span class="nx">my</span><span class="p">.</span><span class="nx">Risks</span><span class="p">;</span>
    <span class="nx">annotate</span> <span class="nx">Risks</span> <span class="kd">with</span> <span class="err">@</span><span class="nx">odata</span><span class="p">.</span><span class="nx">draft</span><span class="p">.</span><span class="nx">enabled</span><span class="p">;</span>
  <span class="nx">entity</span> <span class="nx">Mitigations</span> <span class="nx">as</span> <span class="nx">projection</span> <span class="nx">on</span> <span class="nx">my</span><span class="p">.</span><span class="nx">Mitigations</span><span class="p">;</span>
    <span class="nx">annotate</span> <span class="nx">Mitigations</span> <span class="kd">with</span> <span class="err">@</span><span class="nx">odata</span><span class="p">.</span><span class="nx">draft</span><span class="p">.</span><span class="nx">enabled</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<p>It creates a new service <code>RiskService</code> in the namespace <code>sap.ui.riskmanagement</code>. This service exposes two entities (again just neglect the commented part for the business partner): <code>Risks</code> and <code>Mitigations</code>, which are exposing the entities of the database schema you’ve created in the step before.</p>
<p>If you again look at the terminal, you see that the CAP server has noticed the new file and now tells us that it serves something under <a href="http://localhost:4004">http://localhost:4004</a>.</p>
</li>
<li>
<p>Open a browser with <a href="http://localhost:4004">http://localhost:4004</a> and you see:</p>
<p><img alt="Service" src="../markdown/images/service.png" title="Service" /></p>
<div class="admonition info">
<p class="admonition-title">You may have to stop and restart the <code>cds watch</code> command.</p>
</div>
</li>
<li>
<p>Choose the <code>$metadata</code> link.</p>
<p>You see the OData metadata document of your new service. So, with just the two files for the database schema and the service exposure you added to your project, you've already got a running OData service!
You might wonder why the service itself is called <code>risk</code> even though in the file it’s called <code>RiskService</code>. This is a convention in CAP, the service suffix is subtracted from the name.</p>
<p>If you now choose the <code>Risks</code> link, you only get this:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="err">@</span><span class="nx">odata</span><span class="p">.</span><span class="nx">context</span><span class="o">:</span> <span class="s2">&quot;$metadata#Risks&quot;</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="p">[</span> <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>So, there’s no data yet. This is because so far, your model doesn’t contain any data. You add some now.</p>
</li>
<li>
<p>Copy the folder <code>data</code> from <code>templates/cap/create-service/db</code> to the <code>db</code> folder of your app. If VS Code asks you whether to copy the folder, confirm.</p>
<p>You’ve now added two comma-separated value (CSV) files that contain local data for both the <code>Risks</code> and the <code>Mitigations</code> entities. A quick look into the <code>sap.ui.riskmanagement-Risks.csv</code> (the name consists of your namespace and the name of your database entity from the <code>schema.cds</code> file) file shows data like this:</p>
<div class="highlight"><pre><span></span><code>ID;createdAt;createdBy;title;prio;descr;miti_id;impact
20466922-7d57-4e76-b14c-e53fd97dcb11;2019-10-24;tim.back@sap.com;CFR non-compliance;Fred Fish;3;Recent restructuring might violate CFR code 71;20466921-7d57-4e76-b14c-e53fd97dcb11;10000
...
</code></pre></div>
<p>The first line contains all the properties from your <code>Risks</code> entity. While the other ones are straight forward, consider the <code>miti_id</code> property. In your entity, you only have a <code>miti</code> property, so where does it come from? <code>miti</code> is an association to <code>Mitigations</code>, as <code>Mitigations</code> could have several key properties, the association on the database needs to point to all of these, therefore the CAP server creates a property <code>&lt;AssociationProperty&gt;_&lt;AssociatedEntityKey&gt;</code> for each key.</p>
<p>As always, the CAP server has noticed the change.</p>
<div class="admonition info">
<p class="admonition-title">You may have to stop and restart the <code>cds watch</code> command.</p>
</div>
</li>
<li>
<p>Revisit the <code>Risks</code> entity <a href="http://localhost:4004/service/risk/Risks">http://localhost:4004/service/risk/Risks</a> in your browser, you now see the data exposed:</p>
<p><img alt="Service Data" src="../markdown/images/servicedata.png" title="Service Data" /></p>
</li>
</ol>
<p>And that's it: You’ve now got a full blown OData service, which complies to the OData standard and supports the respective queries without having to code anything but the data model and exposing the service itself.</p>
<div class="admonition info">
<p class="admonition-title">The service is completely exposed without any authentication or authorization check. You extend the service later with such checks.</p>
</div>
<p>The result of these steps can be found <a href="https://github.com/SAP-samples/cloud-cap-risk-management/tree/cap/create-service">here</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../Tutorial_Overview/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Tutorial Overview
            </div>
          </div>
        </a>
      
      
        <a href="../FE/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Create an SAP Fiori Elements-Based Application
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.65ce87ac.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.4.8/dist/mermaid.min.js"></script>
      
    
  </body>
</html>